{"ast":null,"code":"import{createContext,useState,useEffect}from'react';import{jwtDecode}from\"jwt-decode\";import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export default AuthContext;export const AuthProvider=_ref=>{let{children}=_ref;let[authTokens,setAuthTokens]=useState(()=>localStorage.getItem('authTokens')?JSON.parse(localStorage.getItem('authTokens')):null);let[user,setUser]=useState(()=>localStorage.getItem('authTokens')?jwtDecode(localStorage.getItem('authTokens')):null);let[loading,setLoading]=useState(true);const history=useNavigate();let loginUser=async e=>{e.preventDefault();let response=await fetch('http://localhost:8000/api/token/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'username':e.target.username.value,'password':e.target.password.value})});let data=await response.json();if(response.status===200){setAuthTokens(data);setUser(jwtDecode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));history('/home');}else{alert('Something went wrong!');}};let logoutUser=()=>{setAuthTokens(null);setUser(null);localStorage.removeItem('authTokens');console.log(\"Logout\");history('/login');};let updateToken=async()=>{var _authTokens;authTokens=localStorage.getItem('authTokens')?JSON.parse(localStorage.getItem('authTokens')):null;console.log(authTokens);let response=await fetch('http://localhost:8000/api/token/refresh/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'refresh':(_authTokens=authTokens)===null||_authTokens===void 0?void 0:_authTokens.refresh})});let data=await response.json();console.log(data);if(response.status===200){setAuthTokens(data);setUser(jwtDecode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));}else{logoutUser();}if(loading){setLoading(false);}};let contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser};useEffect(()=>{if(loading){updateToken();}// let fourMinutes = 1000 * 60 * 4\nlet fourMinutes=1000*500;let interval=setInterval(()=>{if(authTokens){updateToken();}},fourMinutes);return()=>clearInterval(interval);},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"names":["createContext","useState","useEffect","jwtDecode","useNavigate","jsx","_jsx","AuthContext","AuthProvider","_ref","children","authTokens","setAuthTokens","localStorage","getItem","JSON","parse","user","setUser","loading","setLoading","history","loginUser","e","preventDefault","response","fetch","method","headers","body","stringify","target","username","value","password","data","json","status","access","setItem","alert","logoutUser","removeItem","console","log","updateToken","_authTokens","refresh","contextData","fourMinutes","interval","setInterval","clearInterval","Provider"],"sources":["C:/Users/phah0/Desktop/HyperApp/apps/frontend/src/Context/AuthContext.jsx"],"sourcesContent":["import { createContext, useState, useEffect } from 'react'\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport { useNavigate } from 'react-router-dom'\r\n\r\nconst AuthContext = createContext()\r\n\r\nexport default AuthContext;\r\n\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    let [authTokens, setAuthTokens] = useState(() => localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null)\r\n    let [user, setUser] = useState(() => localStorage.getItem('authTokens') ? jwtDecode(localStorage.getItem('authTokens')) : null)\r\n    let [loading, setLoading] = useState(true)\r\n\r\n    const history = useNavigate()\r\n\r\n    let loginUser = async (e) => {\r\n        e.preventDefault()\r\n        let response = await fetch('http://localhost:8000/api/token/', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({ 'username': e.target.username.value, 'password': e.target.password.value })\r\n        })\r\n        let data = await response.json()\r\n\r\n        if (response.status === 200) {\r\n            setAuthTokens(data)\r\n            setUser(jwtDecode(data.access))\r\n            localStorage.setItem('authTokens', JSON.stringify(data))\r\n            history('/home')\r\n        } else {\r\n            alert('Something went wrong!')\r\n        }\r\n    }\r\n\r\n\r\n    let logoutUser = () => {\r\n        setAuthTokens(null)\r\n        setUser(null)\r\n        localStorage.removeItem('authTokens')\r\n        console.log(\"Logout\")\r\n        history('/login')\r\n    }\r\n\r\n\r\n    let updateToken = async () => {\r\n        authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null\r\n        console.log(authTokens)\r\n\r\n        let response = await fetch('http://localhost:8000/api/token/refresh/', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({ 'refresh': authTokens?.refresh })\r\n        })\r\n\r\n        let data = await response.json()\r\n        console.log(data)\r\n\r\n        if (response.status === 200) {\r\n            setAuthTokens(data)\r\n            setUser(jwtDecode(data.access))\r\n            localStorage.setItem('authTokens', JSON.stringify(data))\r\n        } else {\r\n            logoutUser()\r\n        }\r\n        if (loading) {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    let contextData = {\r\n        user: user,\r\n        authTokens: authTokens,\r\n        loginUser: loginUser,\r\n        logoutUser: logoutUser,\r\n    }\r\n\r\n\r\n    useEffect(() => {\r\n\r\n        if (loading) {\r\n            updateToken()\r\n        }\r\n\r\n        // let fourMinutes = 1000 * 60 * 4\r\n        let fourMinutes = 1000 * 500\r\n\r\n        let interval = setInterval(() => {\r\n            if (authTokens) {\r\n                updateToken()\r\n            }\r\n        }, fourMinutes)\r\n        return () => clearInterval(interval)\r\n\r\n    }, [authTokens, loading])\r\n\r\n    return (\r\n        <AuthContext.Provider value={contextData} >\r\n            {loading ? null : children}\r\n        </AuthContext.Provider>\r\n    )\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}